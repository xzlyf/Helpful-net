<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xz.helpful.dao.TaskMapper">
    <update id="updateTaskEnable">
        update tasklist
        set is_enable = #{enable}
        where id = #{id}
    </update>
    <select id="findById" resultType="com.xz.helpful.pojo.Task">
        select *
        from tasklist
        where id = #{id}
    </select>
    <select id="findAll" resultType="com.xz.helpful.pojo.Task">
        select task_type, task_pay, task_from, create_time, task_desc, task_url
        from tasklist
        where is_enable = 1
          and is_hidden = 0
    </select>
    <!--随机取一条数据-->
    <select id="getOne" resultType="com.xz.helpful.pojo.Task">
        SELECT *
        FROM tasklist AS t1
                 JOIN (SELECT ROUND(RAND() * (SELECT MAX(id) FROM tasklist)) AS id) AS t2
        WHERE t1.id >= t2.id
        ORDER BY t1.id LIMIT 1;
    </select>
    <!--随机取n条数据-->
    <select id="getMore" resultType="com.xz.helpful.pojo.Task">
        SELECT *
        FROM tasklist as t1
        WHERE t1.id >= (RAND() * (SELECT MAX(id) FROM tasklist)) LIMIT #{size};
    </select>
    <!--随机取出n条数据，并且通过filter.task_id过滤已执行的任务，只返回n条未执行的任务-->
    <select id="getNotInFilterTask" resultType="com.xz.helpful.pojo.Task">
        SELECT *
        FROM tasklist as t1
        WHERE id not in (
            select task_id
            from taskfilter
            where user_id = #{userId}
        )
          and t1.id >= (RAND() * (SELECT MAX(id) FROM tasklist)) limit #{size};

    </select>

</mapper>